{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "0645805f-3872-47ad-bc06-6e413792c4c7",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Expecting file at: C:\\Users\\shanp\\Projects\\SiSePuede\\data\\raw\\Energy Data 16122025.xlsx\n",
      "Exists: True\n"
     ]
    }
   ],
   "source": [
    "# CELL 1\n",
    "import os\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import difflib\n",
    "import traceback\n",
    "\n",
    "# Define your file path (you told me both notebook and file are in C:\\Users\\shanp)\n",
    "file_path = r\"C:\\Users\\shanp\\Projects\\SiSePuede\\data\\raw\\Energy Data 16122025.xlsx\"\n",
    "print(\"Expecting file at:\", file_path)\n",
    "print(\"Exists:\", os.path.exists(file_path))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "bf9decb2-9e8a-46e4-81c6-3edf6b63583d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Sheets in workbook: ['fake_data_energy']\n"
     ]
    }
   ],
   "source": [
    "# CELL 2\n",
    "if not os.path.exists(file_path):\n",
    "    raise FileNotFoundError(f\"Excel file not found at {file_path}. Please ensure the file is exactly at that path.\")\n",
    "\n",
    "xls = pd.ExcelFile(file_path)\n",
    "print(\"Sheets in workbook:\", xls.sheet_names)\n",
    "\n",
    "# We'll try to load a sheet matching the string you gave; if that fails, we'll use the first sheet.\n",
    "preferred_sheet = \"sisepuede_latest_16122005.xlsx\"  # you gave this earlier; we'll attempt it but fallback to first sheet\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "f4b38f72-ca52-4701-903b-b8dfe700fad4",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Could not load by name (sisepuede_latest_16122005.xlsx). Fallback to first sheet: fake_data_energy\n",
      "Raw data shape: (52, 1302)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Unnamed: 1</th>\n",
       "      <th>Unnamed: 2</th>\n",
       "      <th>Unnamed: 3</th>\n",
       "      <th>Unnamed: 4</th>\n",
       "      <th>Unnamed: 5</th>\n",
       "      <th>Unnamed: 6</th>\n",
       "      <th>Unnamed: 7</th>\n",
       "      <th>Unnamed: 8</th>\n",
       "      <th>Unnamed: 9</th>\n",
       "      <th>...</th>\n",
       "      <th>Unnamed: 1292</th>\n",
       "      <th>Unnamed: 1293</th>\n",
       "      <th>Unnamed: 1294</th>\n",
       "      <th>Unnamed: 1295</th>\n",
       "      <th>Unnamed: 1296</th>\n",
       "      <th>Unnamed: 1297</th>\n",
       "      <th>Unnamed: 1298</th>\n",
       "      <th>Unnamed: 1299</th>\n",
       "      <th>Unnamed: 1300</th>\n",
       "      <th>Unnamed: 1301</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>time_period</td>\n",
       "      <td>area_gnrl_country_ha</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_aviation</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_rail_fr...</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_road_he...</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_water_b...</td>\n",
       "      <td>climate_change_factor_gnrl_hydropower_availabi...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_mmm_gdp_other_p...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_tonne_productio...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_tonne_productio...</td>\n",
       "      <td>...</td>\n",
       "      <td>vol_ippu_plastic_m3_ww_per_tonne_production</td>\n",
       "      <td>vol_ippu_recycled_glass_m3_ww_per_tonne_produc...</td>\n",
       "      <td>vol_ippu_recycled_metals_m3_ww_per_tonne_produ...</td>\n",
       "      <td>vol_ippu_recycled_paper_m3_ww_per_tonne_produc...</td>\n",
       "      <td>vol_ippu_recycled_plastic_m3_ww_per_tonne_prod...</td>\n",
       "      <td>vol_ippu_recycled_rubber_and_leather_m3_ww_per...</td>\n",
       "      <td>vol_ippu_recycled_textiles_m3_ww_per_tonne_pro...</td>\n",
       "      <td>vol_ippu_rubber_and_leather_m3_ww_per_tonne_pr...</td>\n",
       "      <td>vol_ippu_textiles_m3_ww_per_tonne_production</td>\n",
       "      <td>vol_ippu_wood_m3_ww_per_tonne_production</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2025</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2024</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2023</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2021</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2020</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2019</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2018</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2017</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>25</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows × 1302 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Unnamed: 0            Unnamed: 1  \\\n",
       "0  time_period  area_gnrl_country_ha   \n",
       "1         2025                   NaN   \n",
       "2         2024                   NaN   \n",
       "3         2023                   NaN   \n",
       "4         2022               6552500   \n",
       "5         2021               6552500   \n",
       "6         2020               6552500   \n",
       "7         2019               6552500   \n",
       "8         2018               6552500   \n",
       "9         2017               6552500   \n",
       "\n",
       "                                        Unnamed: 2  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_aviation   \n",
       "1                                              NaN   \n",
       "2                                              NaN   \n",
       "3                                              NaN   \n",
       "4                                                0   \n",
       "5                                                0   \n",
       "6                                                0   \n",
       "7                                                0   \n",
       "8                                                0   \n",
       "9                                                0   \n",
       "\n",
       "                                          Unnamed: 3  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_rail_fr...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                               2317   \n",
       "5                                               2317   \n",
       "6                                               2317   \n",
       "7                                               2317   \n",
       "8                                               2317   \n",
       "9                                               2317   \n",
       "\n",
       "                                          Unnamed: 4  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_road_he...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 20   \n",
       "5                                                 20   \n",
       "6                                                 20   \n",
       "7                                                 20   \n",
       "8                                                 20   \n",
       "9                                                 20   \n",
       "\n",
       "                                          Unnamed: 5  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_water_b...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                               2000   \n",
       "5                                               2000   \n",
       "6                                               2000   \n",
       "7                                               2000   \n",
       "8                                               2000   \n",
       "9                                               2000   \n",
       "\n",
       "                                          Unnamed: 6  \\\n",
       "0  climate_change_factor_gnrl_hydropower_availabi...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  1   \n",
       "5                                                  1   \n",
       "6                                                  1   \n",
       "7                                                  1   \n",
       "8                                                  1   \n",
       "9                                                  1   \n",
       "\n",
       "                                          Unnamed: 7  \\\n",
       "0  consumpinit_inen_energy_tj_per_mmm_gdp_other_p...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                0.4   \n",
       "5                                                0.4   \n",
       "6                                                0.4   \n",
       "7                                                0.4   \n",
       "8                                                0.4   \n",
       "9                                                0.4   \n",
       "\n",
       "                                          Unnamed: 8  \\\n",
       "0  consumpinit_inen_energy_tj_per_tonne_productio...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                              0.005   \n",
       "5                                              0.005   \n",
       "6                                              0.005   \n",
       "7                                              0.005   \n",
       "8                                              0.005   \n",
       "9                                              0.005   \n",
       "\n",
       "                                          Unnamed: 9  ...  \\\n",
       "0  consumpinit_inen_energy_tj_per_tonne_productio...  ...   \n",
       "1                                                NaN  ...   \n",
       "2                                                NaN  ...   \n",
       "3                                                NaN  ...   \n",
       "4                                               0.02  ...   \n",
       "5                                               0.02  ...   \n",
       "6                                               0.02  ...   \n",
       "7                                               0.02  ...   \n",
       "8                                               0.02  ...   \n",
       "9                                               0.02  ...   \n",
       "\n",
       "                                 Unnamed: 1292  \\\n",
       "0  vol_ippu_plastic_m3_ww_per_tonne_production   \n",
       "1                                          NaN   \n",
       "2                                          NaN   \n",
       "3                                          NaN   \n",
       "4                                           25   \n",
       "5                                           25   \n",
       "6                                           25   \n",
       "7                                           25   \n",
       "8                                           25   \n",
       "9                                           25   \n",
       "\n",
       "                                       Unnamed: 1293  \\\n",
       "0  vol_ippu_recycled_glass_m3_ww_per_tonne_produc...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  2   \n",
       "5                                                  2   \n",
       "6                                                  2   \n",
       "7                                                  2   \n",
       "8                                                  2   \n",
       "9                                                  2   \n",
       "\n",
       "                                       Unnamed: 1294  \\\n",
       "0  vol_ippu_recycled_metals_m3_ww_per_tonne_produ...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                3.4   \n",
       "5                                                3.4   \n",
       "6                                                3.4   \n",
       "7                                                3.4   \n",
       "8                                                3.4   \n",
       "9                                                3.4   \n",
       "\n",
       "                                       Unnamed: 1295  \\\n",
       "0  vol_ippu_recycled_paper_m3_ww_per_tonne_produc...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  3   \n",
       "5                                                  3   \n",
       "6                                                  3   \n",
       "7                                                  3   \n",
       "8                                                  3   \n",
       "9                                                  3   \n",
       "\n",
       "                                       Unnamed: 1296  \\\n",
       "0  vol_ippu_recycled_plastic_m3_ww_per_tonne_prod...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  4   \n",
       "5                                                  4   \n",
       "6                                                  4   \n",
       "7                                                  4   \n",
       "8                                                  4   \n",
       "9                                                  4   \n",
       "\n",
       "                                       Unnamed: 1297  \\\n",
       "0  vol_ippu_recycled_rubber_and_leather_m3_ww_per...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 16   \n",
       "5                                                 16   \n",
       "6                                                 16   \n",
       "7                                                 16   \n",
       "8                                                 16   \n",
       "9                                                 16   \n",
       "\n",
       "                                       Unnamed: 1298  \\\n",
       "0  vol_ippu_recycled_textiles_m3_ww_per_tonne_pro...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 16   \n",
       "5                                                 16   \n",
       "6                                                 16   \n",
       "7                                                 16   \n",
       "8                                                 16   \n",
       "9                                                 16   \n",
       "\n",
       "                                       Unnamed: 1299  \\\n",
       "0  vol_ippu_rubber_and_leather_m3_ww_per_tonne_pr...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 25   \n",
       "5                                                 25   \n",
       "6                                                 25   \n",
       "7                                                 25   \n",
       "8                                                 25   \n",
       "9                                                 25   \n",
       "\n",
       "                                  Unnamed: 1300  \\\n",
       "0  vol_ippu_textiles_m3_ww_per_tonne_production   \n",
       "1                                           NaN   \n",
       "2                                           NaN   \n",
       "3                                           NaN   \n",
       "4                                            25   \n",
       "5                                            25   \n",
       "6                                            25   \n",
       "7                                            25   \n",
       "8                                            25   \n",
       "9                                            25   \n",
       "\n",
       "                              Unnamed: 1301  \n",
       "0  vol_ippu_wood_m3_ww_per_tonne_production  \n",
       "1                                       NaN  \n",
       "2                                       NaN  \n",
       "3                                       NaN  \n",
       "4                                        25  \n",
       "5                                        25  \n",
       "6                                        25  \n",
       "7                                        25  \n",
       "8                                        25  \n",
       "9                                        25  \n",
       "\n",
       "[10 rows x 1302 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# CELL 3\n",
    "try:\n",
    "    # Try loading the sheet by exact name first (in case that's actually the sheet name)\n",
    "    df_raw = pd.read_excel(file_path, sheet_name=preferred_sheet)\n",
    "    used_sheet = preferred_sheet\n",
    "    print(f\"Loaded sheet by name: {used_sheet}\")\n",
    "except Exception as e:\n",
    "    # Fallback to first sheet\n",
    "    df_raw = pd.read_excel(file_path, sheet_name=0)\n",
    "    used_sheet = xls.sheet_names[0]\n",
    "    print(f\"Could not load by name ({preferred_sheet}). Fallback to first sheet: {used_sheet}\")\n",
    "\n",
    "print(\"Raw data shape:\", df_raw.shape)\n",
    "display(df_raw.head(10))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "670c6a37-530b-421e-aa19-f0c39b552ddf",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Columns (first 80 shown):\n",
      "1. Unnamed: 0\n",
      "2. Unnamed: 1\n",
      "3. Unnamed: 2\n",
      "4. Unnamed: 3\n",
      "5. Unnamed: 4\n",
      "6. Unnamed: 5\n",
      "7. Unnamed: 6\n",
      "8. Unnamed: 7\n",
      "9. Unnamed: 8\n",
      "10. Unnamed: 9\n",
      "11. Unnamed: 10\n",
      "12. Unnamed: 11\n",
      "13. Unnamed: 12\n",
      "14. Unnamed: 13\n",
      "15. Unnamed: 14\n",
      "16. Unnamed: 15\n",
      "17. Unnamed: 16\n",
      "18. Unnamed: 17\n",
      "19. Unnamed: 18\n",
      "20. Unnamed: 19\n",
      "21. Unnamed: 20\n",
      "22. Unnamed: 21\n",
      "23. Unnamed: 22\n",
      "24. Unnamed: 23\n",
      "25. Unnamed: 24\n",
      "26. Unnamed: 25\n",
      "27. Unnamed: 26\n",
      "28. Unnamed: 27\n",
      "29. Unnamed: 28\n",
      "30. Unnamed: 29\n",
      "31. Unnamed: 30\n",
      "32. Unnamed: 31\n",
      "33. Unnamed: 32\n",
      "34. Unnamed: 33\n",
      "35. Unnamed: 34\n",
      "36. Unnamed: 35\n",
      "37. Unnamed: 36\n",
      "38. Unnamed: 37\n",
      "39. Unnamed: 38\n",
      "40. Unnamed: 39\n",
      "41. Unnamed: 40\n",
      "42. Unnamed: 41\n",
      "43. Unnamed: 42\n",
      "44. Unnamed: 43\n",
      "45. Unnamed: 44\n",
      "46. Unnamed: 45\n",
      "47. Unnamed: 46\n",
      "48. Unnamed: 47\n",
      "49. Unnamed: 48\n",
      "50. Unnamed: 49\n",
      "51. Unnamed: 50\n",
      "52. Unnamed: 51\n",
      "53. Unnamed: 52\n",
      "54. Unnamed: 53\n",
      "55. Unnamed: 54\n",
      "56. Unnamed: 55\n",
      "57. Unnamed: 56\n",
      "58. Unnamed: 57\n",
      "59. Unnamed: 58\n",
      "60. Unnamed: 59\n",
      "61. Unnamed: 60\n",
      "62. Unnamed: 61\n",
      "63. Unnamed: 62\n",
      "64. Unnamed: 63\n",
      "65. Unnamed: 64\n",
      "66. Unnamed: 65\n",
      "67. Unnamed: 66\n",
      "68. Unnamed: 67\n",
      "69. Unnamed: 68\n",
      "70. Unnamed: 69\n",
      "71. Unnamed: 70\n",
      "72. Unnamed: 71\n",
      "73. Unnamed: 72\n",
      "74. Unnamed: 73\n",
      "75. Unnamed: 74\n",
      "76. Unnamed: 75\n",
      "77. Unnamed: 76\n",
      "78. Unnamed: 77\n",
      "79. Unnamed: 78\n",
      "80. Unnamed: 79\n",
      "\n",
      "Column dtypes (first 40):\n",
      "Unnamed: 0     object\n",
      "Unnamed: 1     object\n",
      "Unnamed: 2     object\n",
      "Unnamed: 3     object\n",
      "Unnamed: 4     object\n",
      "Unnamed: 5     object\n",
      "Unnamed: 6     object\n",
      "Unnamed: 7     object\n",
      "Unnamed: 8     object\n",
      "Unnamed: 9     object\n",
      "Unnamed: 10    object\n",
      "Unnamed: 11    object\n",
      "Unnamed: 12    object\n",
      "Unnamed: 13    object\n",
      "Unnamed: 14    object\n",
      "Unnamed: 15    object\n",
      "Unnamed: 16    object\n",
      "Unnamed: 17    object\n",
      "Unnamed: 18    object\n",
      "Unnamed: 19    object\n",
      "Unnamed: 20    object\n",
      "Unnamed: 21    object\n",
      "Unnamed: 22    object\n",
      "Unnamed: 23    object\n",
      "Unnamed: 24    object\n",
      "Unnamed: 25    object\n",
      "Unnamed: 26    object\n",
      "Unnamed: 27    object\n",
      "Unnamed: 28    object\n",
      "Unnamed: 29    object\n",
      "Unnamed: 30    object\n",
      "Unnamed: 31    object\n",
      "Unnamed: 32    object\n",
      "Unnamed: 33    object\n",
      "Unnamed: 34    object\n",
      "Unnamed: 35    object\n",
      "Unnamed: 36    object\n",
      "Unnamed: 37    object\n",
      "Unnamed: 38    object\n",
      "Unnamed: 39    object\n",
      "dtype: object\n",
      "\n",
      "Top null counts:\n",
      "Unnamed: 575    51\n",
      "Unnamed: 594    51\n",
      "Unnamed: 580    51\n",
      "Unnamed: 654    51\n",
      "Unnamed: 659    51\n",
      "Unnamed: 400    50\n",
      "Unnamed: 401    50\n",
      "Unnamed: 402    50\n",
      "Unnamed: 395    50\n",
      "Unnamed: 404    50\n",
      "Unnamed: 397    50\n",
      "Unnamed: 398    50\n",
      "Unnamed: 413    50\n",
      "Unnamed: 403    50\n",
      "Unnamed: 492    50\n",
      "Unnamed: 423    50\n",
      "Unnamed: 405    50\n",
      "Unnamed: 406    50\n",
      "Unnamed: 407    50\n",
      "Unnamed: 408    50\n",
      "Unnamed: 409    50\n",
      "Unnamed: 410    50\n",
      "Unnamed: 388    50\n",
      "Unnamed: 411    50\n",
      "Unnamed: 412    50\n",
      "Unnamed: 389    50\n",
      "Unnamed: 390    50\n",
      "Unnamed: 391    50\n",
      "Unnamed: 392    50\n",
      "Unnamed: 393    50\n",
      "Unnamed: 394    50\n",
      "Unnamed: 396    50\n",
      "Unnamed: 399    50\n",
      "Unnamed: 767    50\n",
      "Unnamed: 768    50\n",
      "Unnamed: 769    50\n",
      "Unnamed: 770    50\n",
      "Unnamed: 771    50\n",
      "Unnamed: 772    50\n",
      "Unnamed: 773    50\n",
      "dtype: int64\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>dtype</th>\n",
       "      <th>null_count</th>\n",
       "      <th>n_unique</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Unnamed: 575</th>\n",
       "      <td>object</td>\n",
       "      <td>51</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 594</th>\n",
       "      <td>object</td>\n",
       "      <td>51</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 580</th>\n",
       "      <td>object</td>\n",
       "      <td>51</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 654</th>\n",
       "      <td>object</td>\n",
       "      <td>51</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 659</th>\n",
       "      <td>object</td>\n",
       "      <td>51</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 1256</th>\n",
       "      <td>object</td>\n",
       "      <td>43</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 1257</th>\n",
       "      <td>object</td>\n",
       "      <td>43</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 1258</th>\n",
       "      <td>object</td>\n",
       "      <td>43</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 1259</th>\n",
       "      <td>object</td>\n",
       "      <td>43</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Unnamed: 1260</th>\n",
       "      <td>object</td>\n",
       "      <td>43</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>80 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                dtype  null_count  n_unique\n",
       "Unnamed: 575   object          51         2\n",
       "Unnamed: 594   object          51         2\n",
       "Unnamed: 580   object          51         2\n",
       "Unnamed: 654   object          51         2\n",
       "Unnamed: 659   object          51         2\n",
       "...               ...         ...       ...\n",
       "Unnamed: 1256  object          43         3\n",
       "Unnamed: 1257  object          43         3\n",
       "Unnamed: 1258  object          43         3\n",
       "Unnamed: 1259  object          43         3\n",
       "Unnamed: 1260  object          43         3\n",
       "\n",
       "[80 rows x 3 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# CELL 4\n",
    "print(\"Columns (first 80 shown):\")\n",
    "for i, c in enumerate(df_raw.columns[:80], start=1):\n",
    "    print(f\"{i}. {c}\")\n",
    "\n",
    "print(\"\\nColumn dtypes (first 40):\")\n",
    "print(df_raw.dtypes.head(40))\n",
    "\n",
    "print(\"\\nTop null counts:\")\n",
    "print(df_raw.isnull().sum().sort_values(ascending=False).head(40))\n",
    "\n",
    "# summary table for convenience\n",
    "summary = pd.DataFrame({\n",
    "    \"dtype\": df_raw.dtypes.astype(str),\n",
    "    \"null_count\": df_raw.isnull().sum(),\n",
    "    \"n_unique\": df_raw.nunique(dropna=False)\n",
    "}).sort_values(by=\"null_count\", ascending=False)\n",
    "display(summary.head(80))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "6c3aff95-6e5d-4589-b205-4b2c3c8f7121",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\munch\\__init__.py:24: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n",
      "  import pkg_resources\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\utilities\\_toolbox.py:533: UserWarning: Path 'C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\out\\sisepuede_run_2025-12-18T11;32;20.134123' not found. It will not be created.\n",
      "  warnings.warn(msg)\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\core\\model_attributes.py:6830: UserWarning: \n",
      "\n",
      "                        MISSIONSEARCHNOTE: As of 2023-10-06, there is a temporary solution \n",
      "                        implemeted in ModelAttributes.get_variable_to_simplex_group_dictionary() \n",
      "                        to ensure that transition probability rows are enforced on a simplex.\n",
      "                        \n",
      "                        \n",
      "                        FIX THIS ASAP TO DERIVE PROPERLY.\n",
      "                        \n",
      "                        \n",
      "  warnings.warn(\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Loaded SISEPUEDE example input shape: (36, 2419)\n",
      "Example columns (first 60): ['region', 'time_period', 'avgload_trns_freight_tonne_per_vehicle_aviation', 'avgload_trns_freight_tonne_per_vehicle_rail_freight', 'avgload_trns_freight_tonne_per_vehicle_road_heavy_freight', 'avgload_trns_freight_tonne_per_vehicle_water_borne', 'avgmass_lvst_animal_buffalo_kg', 'avgmass_lvst_animal_cattle_dairy_kg', 'avgmass_lvst_animal_cattle_nondairy_kg', 'avgmass_lvst_animal_chickens_kg', 'avgmass_lvst_animal_goats_kg', 'avgmass_lvst_animal_horses_kg', 'avgmass_lvst_animal_mules_kg', 'avgmass_lvst_animal_pigs_kg', 'avgmass_lvst_animal_sheep_kg', 'climate_change_factor_gnrl_hydropower_availability', 'consumpinit_inen_energy_tj_per_tonne_production_mining', 'consumpinit_scoe_tj_per_mmmgdp_commercial_municipal_elec_appliances', 'cost_enfu_fuel_biofuels_usd_per_m3', 'cost_enfu_fuel_biogas_usd_per_mmbtu', 'cost_enfu_fuel_biomass_usd_per_tonne', 'cost_enfu_fuel_coal_usd_per_tonne', 'cost_enfu_fuel_coke_usd_per_tonne', 'cost_enfu_fuel_crude_usd_per_m3', 'cost_enfu_fuel_diesel_usd_per_m3', 'cost_enfu_fuel_electricity_usd_per_mmbtu', 'cost_enfu_fuel_furnace_gas_usd_per_m3', 'cost_enfu_fuel_gasoline_usd_per_m3', 'cost_enfu_fuel_hydrocarbon_gas_liquids_usd_per_mmbtu', 'cost_enfu_fuel_hydrogen_usd_per_mmbtu', 'cost_enfu_fuel_kerosene_usd_per_m3', 'cost_enfu_fuel_natural_gas_usd_per_mmbtu', 'cost_enfu_fuel_nuclear_usd_per_tonne', 'cost_enfu_fuel_oil_usd_per_m3', 'cost_enfu_fuel_waste_usd_per_mmbtu', 'dem_ippu_average_materials_tonne_per_household_cement', 'dem_ippu_average_materials_tonne_per_household_wood', 'deminit_frst_wood_home_use_kg_per_hh', 'demscalar_ippu_cement', 'demscalar_ippu_chemicals', 'demscalar_ippu_construction_and_demolition', 'demscalar_ippu_electronics', 'demscalar_ippu_glass', 'demscalar_ippu_lime_and_carbonite', 'demscalar_ippu_metals', 'demscalar_ippu_mining', 'demscalar_ippu_other_industries', 'demscalar_ippu_other_product_manufacturing', 'demscalar_ippu_paper', 'demscalar_ippu_plastic', 'demscalar_ippu_product_use_lubricants', 'demscalar_ippu_product_use_ods_other', 'demscalar_ippu_product_use_ods_refrigeration', 'demscalar_ippu_product_use_other', 'demscalar_ippu_product_use_paraffin_wax', 'demscalar_ippu_rubber_and_leather', 'demscalar_ippu_textiles', 'demscalar_ippu_wood', 'demscalar_soil_fertilizer_n_per_area', 'demscalar_soil_liming_per_area']\n"
     ]
    }
   ],
   "source": [
    "# CELL 5\n",
    "# Attempt to import sisepuede examples to get the expected column schema.\n",
    "example_loaded = False\n",
    "example_cols = []\n",
    "try:\n",
    "    from sisepuede.manager.sisepuede_examples import SISEPUEDEExamples\n",
    "    examples = SISEPUEDEExamples()\n",
    "    df_example = examples(\"input_data_frame\")\n",
    "    example_cols = list(df_example.columns)\n",
    "    example_loaded = True\n",
    "    print(\"Loaded SISEPUEDE example input shape:\", df_example.shape)\n",
    "    print(\"Example columns (first 60):\", example_cols[:60])\n",
    "except Exception as e:\n",
    "    print(\"Could NOT load SISEPUEDE example automatically. That's ok — we'll proceed with data prep.\")\n",
    "    print(\"Error (truncated):\", str(e)[:300])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "a95131a2-7c0a-4a97-b640-2e0dde2d0e27",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Auto mapping suggestions (your_col -> example_col):\n",
      "'Aveation'  ->  'region'\n",
      "'Electronics'  ->  'prodinit_ippu_electronics_tonne'\n",
      "'Recycled Plastic'  ->  'prodinit_ippu_recycled_plastic_tonne'\n",
      "'Recycled Rubber & Leather'  ->  'prodinit_ippu_recycled_rubber_and_leather_tonne'\n",
      "'Recycled Textiles'  ->  'prodinit_ippu_recycled_textiles_tonne'\n",
      "'Road Heavy Regional'  ->  'demscalar_trde_regional'\n",
      "'Other Product'  ->  'ef_frst_c_per_wood_products'\n",
      "'Rubber & Leather'  ->  'physparam_waso_k_rubber_leather'\n",
      "'Recycled  Glass'  ->  'frac_waso_recycled_glass'\n",
      "'Recycled Metal'  ->  'frac_waso_recycled_metal'\n",
      "'Recycled Paper'  ->  'prodinit_ippu_recycled_paper_tonne'\n",
      "'Recycled Wood'  ->  'frac_waso_recycled_wood'\n",
      "'Agriculture and Livestock'  ->  'consumpinit_inen_energy_total_pj_agriculture_and_livestock'\n",
      "'Commercial Municiple'  ->  'scalar_scoe_heat_energy_demand_commercial_municipal'\n"
     ]
    }
   ],
   "source": [
    "# CELL 6\n",
    "my_cols = list(df_raw.columns)\n",
    "mapping_suggestion = {}\n",
    "if example_loaded and example_cols:\n",
    "    for ex in example_cols:\n",
    "        matches = difflib.get_close_matches(ex, my_cols, n=1, cutoff=0.45)\n",
    "        if matches:\n",
    "            mapping_suggestion[matches[0]] = ex\n",
    "\n",
    "    print(\"Auto mapping suggestions (your_col -> example_col):\")\n",
    "    for your_col, ex_col in mapping_suggestion.items():\n",
    "        print(f\"'{your_col}'  ->  '{ex_col}'\")\n",
    "else:\n",
    "    print(\"No example columns available for mapping suggestions. You will need to map manually if required.\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "959decb7-ae53-45c0-a841-cd76bf7f490e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Applied 14 automatic renames.\n",
      "No year-like column found. Creating time_period with default 2015.\n",
      "df_mapped shape: (52, 1303)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Unnamed: 1</th>\n",
       "      <th>Unnamed: 2</th>\n",
       "      <th>Unnamed: 3</th>\n",
       "      <th>Unnamed: 4</th>\n",
       "      <th>Unnamed: 5</th>\n",
       "      <th>Unnamed: 6</th>\n",
       "      <th>Unnamed: 7</th>\n",
       "      <th>Unnamed: 8</th>\n",
       "      <th>Unnamed: 9</th>\n",
       "      <th>...</th>\n",
       "      <th>Unnamed: 1293</th>\n",
       "      <th>Unnamed: 1294</th>\n",
       "      <th>Unnamed: 1295</th>\n",
       "      <th>Unnamed: 1296</th>\n",
       "      <th>Unnamed: 1297</th>\n",
       "      <th>Unnamed: 1298</th>\n",
       "      <th>Unnamed: 1299</th>\n",
       "      <th>Unnamed: 1300</th>\n",
       "      <th>Unnamed: 1301</th>\n",
       "      <th>time_period</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>time_period</td>\n",
       "      <td>area_gnrl_country_ha</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_aviation</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_rail_fr...</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_road_he...</td>\n",
       "      <td>avgload_trns_freight_tonne_per_vehicle_water_b...</td>\n",
       "      <td>climate_change_factor_gnrl_hydropower_availabi...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_mmm_gdp_other_p...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_tonne_productio...</td>\n",
       "      <td>consumpinit_inen_energy_tj_per_tonne_productio...</td>\n",
       "      <td>...</td>\n",
       "      <td>vol_ippu_recycled_glass_m3_ww_per_tonne_produc...</td>\n",
       "      <td>vol_ippu_recycled_metals_m3_ww_per_tonne_produ...</td>\n",
       "      <td>vol_ippu_recycled_paper_m3_ww_per_tonne_produc...</td>\n",
       "      <td>vol_ippu_recycled_plastic_m3_ww_per_tonne_prod...</td>\n",
       "      <td>vol_ippu_recycled_rubber_and_leather_m3_ww_per...</td>\n",
       "      <td>vol_ippu_recycled_textiles_m3_ww_per_tonne_pro...</td>\n",
       "      <td>vol_ippu_rubber_and_leather_m3_ww_per_tonne_pr...</td>\n",
       "      <td>vol_ippu_textiles_m3_ww_per_tonne_production</td>\n",
       "      <td>vol_ippu_wood_m3_ww_per_tonne_production</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2025</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2024</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2023</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2021</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2020</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2019</td>\n",
       "      <td>6552500</td>\n",
       "      <td>0</td>\n",
       "      <td>2317</td>\n",
       "      <td>20</td>\n",
       "      <td>2000</td>\n",
       "      <td>1</td>\n",
       "      <td>0.4</td>\n",
       "      <td>0.005</td>\n",
       "      <td>0.02</td>\n",
       "      <td>...</td>\n",
       "      <td>2</td>\n",
       "      <td>3.4</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>25</td>\n",
       "      <td>2015</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>8 rows × 1303 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Unnamed: 0            Unnamed: 1  \\\n",
       "0  time_period  area_gnrl_country_ha   \n",
       "1         2025                   NaN   \n",
       "2         2024                   NaN   \n",
       "3         2023                   NaN   \n",
       "4         2022               6552500   \n",
       "5         2021               6552500   \n",
       "6         2020               6552500   \n",
       "7         2019               6552500   \n",
       "\n",
       "                                        Unnamed: 2  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_aviation   \n",
       "1                                              NaN   \n",
       "2                                              NaN   \n",
       "3                                              NaN   \n",
       "4                                                0   \n",
       "5                                                0   \n",
       "6                                                0   \n",
       "7                                                0   \n",
       "\n",
       "                                          Unnamed: 3  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_rail_fr...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                               2317   \n",
       "5                                               2317   \n",
       "6                                               2317   \n",
       "7                                               2317   \n",
       "\n",
       "                                          Unnamed: 4  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_road_he...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 20   \n",
       "5                                                 20   \n",
       "6                                                 20   \n",
       "7                                                 20   \n",
       "\n",
       "                                          Unnamed: 5  \\\n",
       "0  avgload_trns_freight_tonne_per_vehicle_water_b...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                               2000   \n",
       "5                                               2000   \n",
       "6                                               2000   \n",
       "7                                               2000   \n",
       "\n",
       "                                          Unnamed: 6  \\\n",
       "0  climate_change_factor_gnrl_hydropower_availabi...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  1   \n",
       "5                                                  1   \n",
       "6                                                  1   \n",
       "7                                                  1   \n",
       "\n",
       "                                          Unnamed: 7  \\\n",
       "0  consumpinit_inen_energy_tj_per_mmm_gdp_other_p...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                0.4   \n",
       "5                                                0.4   \n",
       "6                                                0.4   \n",
       "7                                                0.4   \n",
       "\n",
       "                                          Unnamed: 8  \\\n",
       "0  consumpinit_inen_energy_tj_per_tonne_productio...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                              0.005   \n",
       "5                                              0.005   \n",
       "6                                              0.005   \n",
       "7                                              0.005   \n",
       "\n",
       "                                          Unnamed: 9  ...  \\\n",
       "0  consumpinit_inen_energy_tj_per_tonne_productio...  ...   \n",
       "1                                                NaN  ...   \n",
       "2                                                NaN  ...   \n",
       "3                                                NaN  ...   \n",
       "4                                               0.02  ...   \n",
       "5                                               0.02  ...   \n",
       "6                                               0.02  ...   \n",
       "7                                               0.02  ...   \n",
       "\n",
       "                                       Unnamed: 1293  \\\n",
       "0  vol_ippu_recycled_glass_m3_ww_per_tonne_produc...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  2   \n",
       "5                                                  2   \n",
       "6                                                  2   \n",
       "7                                                  2   \n",
       "\n",
       "                                       Unnamed: 1294  \\\n",
       "0  vol_ippu_recycled_metals_m3_ww_per_tonne_produ...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                3.4   \n",
       "5                                                3.4   \n",
       "6                                                3.4   \n",
       "7                                                3.4   \n",
       "\n",
       "                                       Unnamed: 1295  \\\n",
       "0  vol_ippu_recycled_paper_m3_ww_per_tonne_produc...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  3   \n",
       "5                                                  3   \n",
       "6                                                  3   \n",
       "7                                                  3   \n",
       "\n",
       "                                       Unnamed: 1296  \\\n",
       "0  vol_ippu_recycled_plastic_m3_ww_per_tonne_prod...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                  4   \n",
       "5                                                  4   \n",
       "6                                                  4   \n",
       "7                                                  4   \n",
       "\n",
       "                                       Unnamed: 1297  \\\n",
       "0  vol_ippu_recycled_rubber_and_leather_m3_ww_per...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 16   \n",
       "5                                                 16   \n",
       "6                                                 16   \n",
       "7                                                 16   \n",
       "\n",
       "                                       Unnamed: 1298  \\\n",
       "0  vol_ippu_recycled_textiles_m3_ww_per_tonne_pro...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 16   \n",
       "5                                                 16   \n",
       "6                                                 16   \n",
       "7                                                 16   \n",
       "\n",
       "                                       Unnamed: 1299  \\\n",
       "0  vol_ippu_rubber_and_leather_m3_ww_per_tonne_pr...   \n",
       "1                                                NaN   \n",
       "2                                                NaN   \n",
       "3                                                NaN   \n",
       "4                                                 25   \n",
       "5                                                 25   \n",
       "6                                                 25   \n",
       "7                                                 25   \n",
       "\n",
       "                                  Unnamed: 1300  \\\n",
       "0  vol_ippu_textiles_m3_ww_per_tonne_production   \n",
       "1                                           NaN   \n",
       "2                                           NaN   \n",
       "3                                           NaN   \n",
       "4                                            25   \n",
       "5                                            25   \n",
       "6                                            25   \n",
       "7                                            25   \n",
       "\n",
       "                              Unnamed: 1301 time_period  \n",
       "0  vol_ippu_wood_m3_ww_per_tonne_production        2015  \n",
       "1                                       NaN        2015  \n",
       "2                                       NaN        2015  \n",
       "3                                       NaN        2015  \n",
       "4                                        25        2015  \n",
       "5                                        25        2015  \n",
       "6                                        25        2015  \n",
       "7                                        25        2015  \n",
       "\n",
       "[8 rows x 1303 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# CELL 7\n",
    "df_mapped = df_raw.copy()\n",
    "\n",
    "# Apply the automatic mapping if we produced suggestions\n",
    "if mapping_suggestion:\n",
    "    rename_dict = {your_col: ex_col for your_col, ex_col in mapping_suggestion.items()}\n",
    "    df_mapped = df_mapped.rename(columns=rename_dict)\n",
    "    print(f\"Applied {len(rename_dict)} automatic renames.\")\n",
    "else:\n",
    "    print(\"No automatic renames applied. You can rename manually with df_mapped.rename(columns={...}, inplace=True).\")\n",
    "\n",
    "# Ensure minimal required columns exist for SISEPUEDE workflows: 'region' and 'time_period'\n",
    "if 'region' not in df_mapped.columns:\n",
    "    print(\"`region` missing — adding default 'costa_rica'.\")\n",
    "    df_mapped['region'] = 'costa_rica'\n",
    "\n",
    "# Try to detect a year/time column for time_period; otherwise default to 2015\n",
    "if 'time_period' not in df_mapped.columns:\n",
    "    candidate_year_cols = [c for c in df_mapped.columns if c.lower() in ('year','years','time','time_period','period')]\n",
    "    if candidate_year_cols:\n",
    "        chosen = candidate_year_cols[0]\n",
    "        print(\"Found a candidate year column:\", chosen, \"— copying to time_period (coerced to int).\")\n",
    "        df_mapped['time_period'] = pd.to_numeric(df_mapped[chosen], errors='coerce').fillna(2015).astype(int)\n",
    "    else:\n",
    "        print(\"No year-like column found. Creating time_period with default 2015.\")\n",
    "        df_mapped['time_period'] = 2015\n",
    "\n",
    "# Ensure time_period int\n",
    "try:\n",
    "    df_mapped['time_period'] = df_mapped['time_period'].astype(int)\n",
    "except Exception:\n",
    "    df_mapped['time_period'] = pd.to_numeric(df_mapped['time_period'], errors='coerce').fillna(2015).astype(int)\n",
    "\n",
    "print(\"df_mapped shape:\", df_mapped.shape)\n",
    "display(df_mapped.head(8))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "63f93f6f-be3f-420f-afb7-3cf7c7e7adc2",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Missing columns (count 2404). Showing up to 80:\n",
      "['area_gnrl_country_ha', 'area_lndu_infimum_croplands_ha', 'area_lndu_infimum_flooded_ha', 'area_lndu_infimum_forests_mangroves_ha', 'area_lndu_infimum_forests_primary_ha', 'area_lndu_infimum_forests_secondary_ha', 'area_lndu_infimum_grasslands_ha', 'area_lndu_infimum_other_ha', 'area_lndu_infimum_pastures_ha', 'area_lndu_infimum_settlements_ha', 'area_lndu_infimum_shrublands_ha', 'area_lndu_infimum_wetlands_ha', 'area_lndu_supremum_croplands_ha', 'area_lndu_supremum_flooded_ha', 'area_lndu_supremum_forests_mangroves_ha', 'area_lndu_supremum_forests_primary_ha', 'area_lndu_supremum_forests_secondary_ha', 'area_lndu_supremum_grasslands_ha', 'area_lndu_supremum_other_ha', 'area_lndu_supremum_pastures_ha', 'area_lndu_supremum_settlements_ha', 'area_lndu_supremum_shrublands_ha', 'area_lndu_supremum_wetlands_ha', 'avgload_trns_freight_tonne_per_vehicle_aviation', 'avgload_trns_freight_tonne_per_vehicle_rail_freight', 'avgload_trns_freight_tonne_per_vehicle_road_heavy_freight', 'avgload_trns_freight_tonne_per_vehicle_water_borne', 'avgmass_lvst_animal_buffalo_kg', 'avgmass_lvst_animal_cattle_dairy_kg', 'avgmass_lvst_animal_cattle_nondairy_kg', 'avgmass_lvst_animal_chickens_kg', 'avgmass_lvst_animal_goats_kg', 'avgmass_lvst_animal_horses_kg', 'avgmass_lvst_animal_mules_kg', 'avgmass_lvst_animal_pigs_kg', 'avgmass_lvst_animal_sheep_kg', 'climate_change_factor_gnrl_hydropower_availability', 'consumpinit_inen_energy_tj_per_mmm_gdp_other_product_manufacturing', 'consumpinit_inen_energy_tj_per_tonne_production_cement', 'consumpinit_inen_energy_tj_per_tonne_production_chemicals', 'consumpinit_inen_energy_tj_per_tonne_production_electronics', 'consumpinit_inen_energy_tj_per_tonne_production_glass', 'consumpinit_inen_energy_tj_per_tonne_production_lime_and_carbonite', 'consumpinit_inen_energy_tj_per_tonne_production_metals', 'consumpinit_inen_energy_tj_per_tonne_production_mining', 'consumpinit_inen_energy_tj_per_tonne_production_paper', 'consumpinit_inen_energy_tj_per_tonne_production_plastic', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_glass', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_metals', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_paper', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_plastic', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_rubber_and_leather', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_textiles', 'consumpinit_inen_energy_tj_per_tonne_production_recycled_wood', 'consumpinit_inen_energy_tj_per_tonne_production_rubber_and_leather', 'consumpinit_inen_energy_tj_per_tonne_production_textiles', 'consumpinit_inen_energy_tj_per_tonne_production_wood', 'consumpinit_scoe_gj_per_hh_residential_elec_appliances', 'consumpinit_scoe_gj_per_hh_residential_heat_energy', 'consumpinit_scoe_tj_per_mmmgdp_commercial_municipal_elec_appliances', 'consumpinit_scoe_tj_per_mmmgdp_commercial_municipal_heat_energy', 'consumpinit_scoe_tj_per_mmmgdp_other_se_elec_appliances', 'consumpinit_scoe_tj_per_mmmgdp_other_se_heat_energy', 'cost_enfu_fuel_ammonia_usd_per_tonne', 'cost_enfu_fuel_biofuels_usd_per_m3', 'cost_enfu_fuel_biogas_usd_per_mmbtu', 'cost_enfu_fuel_biomass_usd_per_tonne', 'cost_enfu_fuel_coal_usd_per_tonne', 'cost_enfu_fuel_coke_usd_per_tonne', 'cost_enfu_fuel_crude_usd_per_m3', 'cost_enfu_fuel_diesel_usd_per_m3', 'cost_enfu_fuel_electricity_usd_per_mmbtu', 'cost_enfu_fuel_furnace_gas_usd_per_m3', 'cost_enfu_fuel_gasoline_usd_per_m3', 'cost_enfu_fuel_hydrocarbon_gas_liquids_usd_per_mmbtu', 'cost_enfu_fuel_hydrogen_usd_per_mmbtu', 'cost_enfu_fuel_kerosene_usd_per_m3', 'cost_enfu_fuel_natural_gas_liquid_usd_per_m3', 'cost_enfu_fuel_natural_gas_usd_per_mmbtu', 'cost_enfu_fuel_nuclear_usd_per_tonne']\n",
      "\n",
      "Extra columns in your data (count 1288). Showing up to 80:\n",
      "['Bike', 'Carbonite', 'Cement', 'Chemical', 'Glass', 'Metal', 'Mining', 'Other Sectors', 'Paper', 'Plastic', 'Public', 'Rail Fraight', 'Rail Passenger', 'Residential', 'Road Heavy Fraight', 'Road Light', 'Textile', 'Unnamed: 0', 'Unnamed: 1', 'Unnamed: 10', 'Unnamed: 100', 'Unnamed: 1000', 'Unnamed: 1001', 'Unnamed: 1002', 'Unnamed: 1003', 'Unnamed: 1004', 'Unnamed: 1005', 'Unnamed: 1006', 'Unnamed: 1007', 'Unnamed: 1008', 'Unnamed: 1009', 'Unnamed: 101', 'Unnamed: 1010', 'Unnamed: 1011', 'Unnamed: 1012', 'Unnamed: 1013', 'Unnamed: 1014', 'Unnamed: 1015', 'Unnamed: 1016', 'Unnamed: 1017', 'Unnamed: 1018', 'Unnamed: 1019', 'Unnamed: 102', 'Unnamed: 1020', 'Unnamed: 1021', 'Unnamed: 1022', 'Unnamed: 1023', 'Unnamed: 1024', 'Unnamed: 1025', 'Unnamed: 1026', 'Unnamed: 1027', 'Unnamed: 1028', 'Unnamed: 1029', 'Unnamed: 103', 'Unnamed: 1030', 'Unnamed: 1031', 'Unnamed: 1032', 'Unnamed: 1033', 'Unnamed: 1034', 'Unnamed: 1035', 'Unnamed: 1036', 'Unnamed: 1037', 'Unnamed: 1038', 'Unnamed: 1039', 'Unnamed: 104', 'Unnamed: 1040', 'Unnamed: 1041', 'Unnamed: 1042', 'Unnamed: 1043', 'Unnamed: 1044', 'Unnamed: 1045', 'Unnamed: 1046', 'Unnamed: 1047', 'Unnamed: 1048', 'Unnamed: 1049', 'Unnamed: 105', 'Unnamed: 1050', 'Unnamed: 1051', 'Unnamed: 1052', 'Unnamed: 1053']\n"
     ]
    }
   ],
   "source": [
    "# CELL 8\n",
    "if example_loaded:\n",
    "    example_set = set(example_cols)\n",
    "    my_set = set(df_mapped.columns)\n",
    "    missing = sorted(example_set - my_set)\n",
    "    extra = sorted(my_set - example_set)\n",
    "    print(f\"Missing columns (count {len(missing)}). Showing up to 80:\")\n",
    "    print(missing[:80])\n",
    "    print(f\"\\nExtra columns in your data (count {len(extra)}). Showing up to 80:\")\n",
    "    print(extra[:80])\n",
    "else:\n",
    "    print(\"Example not loaded — skip comparison.\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "02f8c2b8-9125-4e4c-ac4d-3d24744582d2",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Saved cleaned df_mapped to: C:\\Users\\shanp\\df_input_for_sisepuede.csv\n",
      "Prepared df_input shape: (52, 1303)\n"
     ]
    }
   ],
   "source": [
    "# CELL 9\n",
    "out_csv = r\"C:\\Users\\shanp\\df_input_for_sisepuede.csv\"\n",
    "df_mapped.to_csv(out_csv, index=False)\n",
    "print(\"Saved cleaned df_mapped to:\", out_csv)\n",
    "\n",
    "# Use df_input variable used by your pipeline\n",
    "df_input = df_mapped.copy()\n",
    "print(\"Prepared df_input shape:\", df_input.shape)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "42ffc58e-0498-49d7-b137-a04df7525602",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Imported sisepuede successfully.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\utilities\\_toolbox.py:533: UserWarning: Path 'C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\out\\sisepuede_run_2025-12-18T11;32;28.946639' not found. It will not be created.\n",
      "  warnings.warn(msg)\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\core\\model_attributes.py:6830: UserWarning: \n",
      "\n",
      "                        MISSIONSEARCHNOTE: As of 2023-10-06, there is a temporary solution \n",
      "                        implemeted in ModelAttributes.get_variable_to_simplex_group_dictionary() \n",
      "                        to ensure that transition probability rows are enforced on a simplex.\n",
      "                        \n",
      "                        \n",
      "                        FIX THIS ASAP TO DERIVE PROPERLY.\n",
      "                        \n",
      "                        \n",
      "  warnings.warn(\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\utilities\\_toolbox.py:2632: UserWarning: Warning passed from optional_log: Set Julia directory for modules and environment to 'C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\julia'..\n",
      "  warnings.warn(f\"Warning passed from optional_log: {msg}.\")\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Error creating Transformers object:\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Traceback (most recent call last):\n",
      "  File \"C:\\Users\\shanp\\AppData\\Local\\Temp\\ipykernel_7584\\989195065.py\", line 14, in <module>\n",
      "    transformers = trf.Transformers({}, df_input=df_input)\n",
      "                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\transformers\\transformers.py\", line 536, in __init__\n",
      "    self._initialize_baseline_inputs(df_input, )\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\transformers\\transformers.py\", line 659, in _initialize_baseline_inputs\n",
      "    raise RuntimeError(f\"No valid regions found in input data frame `df_input`.\")\n",
      "RuntimeError: No valid regions found in input data frame `df_input`.\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\core\\model_attributes.py:6830: UserWarning: \n",
      "\n",
      "                        MISSIONSEARCHNOTE: As of 2023-10-06, there is a temporary solution \n",
      "                        implemeted in ModelAttributes.get_variable_to_simplex_group_dictionary() \n",
      "                        to ensure that transition probability rows are enforced on a simplex.\n",
      "                        \n",
      "                        \n",
      "                        FIX THIS ASAP TO DERIVE PROPERLY.\n",
      "                        \n",
      "                        \n",
      "  warnings.warn(\n",
      "C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\utilities\\_toolbox.py:2632: UserWarning: Warning passed from optional_log: Successfully archived self.model_attributes to pickle at 'C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\out\\sisepuede_run_2025-12-18T11;32;31.516176\\sisepuede_run_2025-12-18T11;32;31.516176_model_attributes.pkl'.\n",
      "  warnings.warn(f\"Warning passed from optional_log: {msg}.\")\n",
      "2025-12-18 11:32:33,159 - INFO - Successfully initialized SISEPUEDEFileStructure.\n",
      "2025-12-18 11:32:33,164 - WARNING - Missing key dict_dimensional_keys: key time_series not found. Tables that rely on the time_series will not have index checking.\n",
      "2025-12-18 11:32:33,166 - INFO - \tSetting export engine to 'sqlite'.\n",
      "2025-12-18 11:32:33,194 - WARNING - No index fields defined. Index field values will not be checked when writing to tables.\n",
      "2025-12-18 11:32:33,195 - INFO - Successfully instantiated table ANALYSIS_METADATA\n",
      "2025-12-18 11:32:33,197 - WARNING - No index fields found in ATTRIBUTE_DESIGN. Initializing index fields.\n",
      "2025-12-18 11:32:33,199 - INFO - Successfully instantiated table ATTRIBUTE_DESIGN\n",
      "2025-12-18 11:32:33,200 - WARNING - No index fields found in ATTRIBUTE_LHC_SAMPLES_EXOGENOUS_UNCERTAINTIES. Initializing index fields.\n",
      "2025-12-18 11:32:33,201 - INFO - Successfully instantiated table ATTRIBUTE_LHC_SAMPLES_EXOGENOUS_UNCERTAINTIES\n",
      "2025-12-18 11:32:33,204 - WARNING - No index fields found in ATTRIBUTE_LHC_SAMPLES_LEVER_EFFECTS. Initializing index fields.\n",
      "2025-12-18 11:32:33,205 - INFO - Successfully instantiated table ATTRIBUTE_LHC_SAMPLES_LEVER_EFFECTS\n",
      "2025-12-18 11:32:33,206 - WARNING - No index fields found in ATTRIBUTE_PRIMARY. Initializing index fields.\n",
      "2025-12-18 11:32:33,207 - INFO - Successfully instantiated table ATTRIBUTE_PRIMARY\n",
      "2025-12-18 11:32:33,209 - WARNING - No index fields found in ATTRIBUTE_STRATEGY. Initializing index fields.\n",
      "2025-12-18 11:32:33,211 - INFO - Successfully instantiated table ATTRIBUTE_STRATEGY\n",
      "2025-12-18 11:32:33,212 - WARNING - No index fields found in ATTRIBUTE_TIME_PERIOD. Initializing index fields.\n",
      "2025-12-18 11:32:33,214 - INFO - Successfully instantiated table ATTRIBUTE_TIME_PERIOD\n",
      "2025-12-18 11:32:33,216 - WARNING - No index fields found in MODEL_BASE_INPUT_DATABASE. Initializing index fields.\n",
      "2025-12-18 11:32:33,216 - INFO - Successfully instantiated table MODEL_BASE_INPUT_DATABASE\n",
      "2025-12-18 11:32:33,218 - WARNING - No index fields found in MODEL_INPUT. Initializing index fields.\n",
      "2025-12-18 11:32:33,219 - INFO - Successfully instantiated table MODEL_INPUT\n",
      "2025-12-18 11:32:33,220 - WARNING - No index fields found in MODEL_OUTPUT. Initializing index fields.\n",
      "2025-12-18 11:32:33,221 - INFO - Successfully instantiated table MODEL_OUTPUT\n",
      "2025-12-18 11:32:33,222 - INFO - SISEPUEDEOutputDatabase successfully initialized IterativeDatabase.\n",
      "2025-12-18 11:32:33,223 - INFO - Successfully initialized database with:\n",
      "\ttype:\tsqlite\n",
      "\tanalysis id:\tsisepuede_run_2025-12-18T11:32:31.516176\n",
      "\tfp_base_output:\tC:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\out\\sisepuede_run_2025-12-18T11;32;31.516176\\sisepuede_run_2025-12-18T11;32;31.516176_output_database\n",
      "2025-12-18 11:32:33,225 - INFO - Running SISEPUEDE under template data mode 'calibrated'.\n",
      "2025-12-18 11:32:33,225 - INFO - Initializing BaseInputDatabase\n",
      "2025-12-18 11:32:33,226 - ERROR - Error initializing BaseInputDatabase -- 'float' object has no attribute 'strip'\n",
      "2025-12-18 11:32:33,228 - ERROR - Error initializing the experimental manager in _initialize_experimental_manager(): Error initializing BaseInputDatabase -- 'float' object has no attribute 'strip'\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Failed to initialize SISEPUEDE model (dummy). Traceback:\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Traceback (most recent call last):\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede_experimental_manager.py\", line 309, in _initialize_baseline_database\n",
      "    self.base_input_database = BaseInputDatabase(\n",
      "                               ^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\data_management\\ingestion.py\", line 1530, in __init__\n",
      "    self.regions = self.get_regions(regions)\n",
      "                   ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\data_management\\ingestion.py\", line 1614, in get_regions\n",
      "    regions_out = [self.model_attributes.clean_region(region) for region in regions]\n",
      "                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\data_management\\ingestion.py\", line 1614, in <listcomp>\n",
      "    regions_out = [self.model_attributes.clean_region(region) for region in regions]\n",
      "                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\core\\model_attributes.py\", line 2606, in clean_region\n",
      "    out = region.strip().lower().replace(\" \", \"_\")\n",
      "          ^^^^^^^^^^^^\n",
      "AttributeError: 'float' object has no attribute 'strip'\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede.py\", line 618, in _initialize_experimental_manager\n",
      "    self.experimental_manager = SISEPUEDEExperimentalManager(\n",
      "                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede_experimental_manager.py\", line 136, in __init__\n",
      "    self._initialize_baseline_database(\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede_experimental_manager.py\", line 324, in _initialize_baseline_database\n",
      "    raise RuntimeError(msg)\n",
      "RuntimeError: Error initializing BaseInputDatabase -- 'float' object has no attribute 'strip'\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"C:\\Users\\shanp\\AppData\\Local\\Temp\\ipykernel_7584\\989195065.py\", line 36, in <module>\n",
      "    ssp = si.SISEPUEDE(\n",
      "          ^^^^^^^^^^^^^\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede.py\", line 291, in __init__\n",
      "    self._initialize_experimental_manager(\n",
      "  File \"C:\\Users\\shanp\\miniconda3\\envs\\sisepuede\\Lib\\site-packages\\sisepuede\\manager\\sisepuede.py\", line 643, in _initialize_experimental_manager\n",
      "    raise RuntimeError(e)\n",
      "RuntimeError: Error initializing BaseInputDatabase -- 'float' object has no attribute 'strip'\n"
     ]
    }
   ],
   "source": [
    "# CELL 10\n",
    "try:\n",
    "    import sisepuede as si\n",
    "    import sisepuede.transformers as trf\n",
    "    print(\"Imported sisepuede successfully.\")\n",
    "except Exception as e:\n",
    "    print(\"Could not import sisepuede in this environment. If sisepuede is installed, ensure the kernel has it. Error:\")\n",
    "    print(str(e))\n",
    "    trf = None\n",
    "    si = None\n",
    "\n",
    "if trf is not None:\n",
    "    try:\n",
    "        transformers = trf.Transformers({}, df_input=df_input)\n",
    "        print(\"Transformers object created. Count:\", len(transformers.all_transformers))\n",
    "    except Exception as e:\n",
    "        print(\"Error creating Transformers object:\")\n",
    "        traceback.print_exc()\n",
    "        transformers = None\n",
    "\n",
    "    # Try running a couple of common transformers (skip missing)\n",
    "    if transformers is not None:\n",
    "        test_codes = [\"TFR:TRNS:SHIFT_FUEL_MEDIUM_DUTY\", \"TFR:ENTC:TARGET_RENEWABLE_ELEC\"]\n",
    "        for code in test_codes:\n",
    "            try:\n",
    "                transformer = transformers.get_transformer(code)\n",
    "                print(f\"Running transformer: {code}\")\n",
    "                df_transformed = transformer()\n",
    "                print(f\"Transformer {code} produced shape:\", df_transformed.shape)\n",
    "            except Exception as e:\n",
    "                print(f\"Could not run transformer {code}. Error:\")\n",
    "                traceback.print_exc()\n",
    "\n",
    "    # Try initializing a dummy SISEPUEDE model (no Julia)\n",
    "    try:\n",
    "        ssp = si.SISEPUEDE(\n",
    "            \"calibrated\",\n",
    "            id_str=\"test_run\",\n",
    "            initialize_as_dummy=True,\n",
    "            regions=list(df_input['region'].unique())\n",
    "        )\n",
    "        print(\"Dummy SISEPUEDE model initialized. Strategies available:\", len(ssp.attribute_strategy.table))\n",
    "    except Exception:\n",
    "        print(\"Failed to initialize SISEPUEDE model (dummy). Traceback:\")\n",
    "        traceback.print_exc()\n",
    "else:\n",
    "    print(\"Skipping transformer steps since sisepuede import was not available.\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "4741dec6-4f40-4eca-86d1-e7f7a082aeb7",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Numeric columns sample: ['time_period']\n",
      "Plotting sample: time_period\n"
     ]
    },
    {
     "data": {
      "image/png": "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n38uM2bMkOXLl8vhw4fl8ccfD6y/cuWKBe6LFy/KqlWrZNKkSRao+/btGyizb98+K1O7dm0L9p06dZLnn39evvjii0CZadOmSefOnaVfv37y/fff23HXq1dPjh07Fte3DQAAAABAnIV5nufF+8VhYTJz5kxp1KhRlHX79++XQoUKyYYNG6RcuXKB5adOnZIcOXLIlClTpHHjxrZs586dUqJECVm9erVUqVJFFixYII888oiF8Vy5clmZcePGSY8ePeT48eOSJk0a+/958+bJ1q1bA9tu2rSpnDx5UhYuXGjPtWW7YsWKMmrUKHt+9epVyZ8/v3To0EF69ux53fcXEREhmTNntmPOlClTfE8TAAAAACAJSozMl+j3dK9fv14uXbokderUCSwrXry4FChQwEK30p9lypQJBG6lLdR6QrZt2xYoE7wNv4y/DW0l130Fl0mRIoU998sAAAAAAOBSKklkR44csZbqLFmyhCzXgK3r/DLBgdtf76+7VhkN5ufOnZMTJ05YN/XoymjLenQuXLhgD59uCwAAAACA+GL08iCDBw+2rgX+Q7uiAwAAAABw04Tu3LlzW9dvvfc6mI5eruv8MpFHM/efX6+M9sNPly6dZM+eXVKmTBltGX8bkfXq1cv68vuPgwcPJsA7BgAAAADcqhI9dJcvX15Sp04tixcvDizbtWuXTRFWtWpVe64/t2zZEjLK+KJFiyxQlyxZMlAmeBt+GX8b2oVd9xVcRgdS0+d+mch06jHdR/ADAAAAAIBEu6f7zJkzsmfPnpCpu3TKrmzZstlgaL///rsFaB153A/USluX9aHdtlu1amVTeelrNNjqaOIahHXkcqXzfGu4btGihQwZMsTu3+7Tp4/N7a3BWLVp08ZGJe/evbs899xzsmTJEpk+fbqNaO7TfbRs2VIqVKgglSpVknfffdemNHv22WfjfcIAAAAAAHA2ZdiyZctsbuzINNzqXNr6iC7U6lzZ/fv3t/8/f/68dOnSRf773//awGU66viYMWNCun3/9NNP8tJLL9n+MmTIYNt/8803JVWqP78n0HU65/f27dslX7588uqrr8ozzzwTsl8N5kOHDrXgrlOXjRw50qYSiw2mDAMAAACA5CsiEaYM+0vzdCd3hG4AAAAASL4ikuM83QAAAAAA3CoI3QAAAAAAOELoBgAAAADAEUI3AAAAAACO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",
      "text/plain": [
       "<Figure size 1000x400 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# CELL 11\n",
    "numeric_cols = df_input.select_dtypes(include=[\"number\"]).columns.tolist()\n",
    "print(\"Numeric columns sample:\", numeric_cols[:30])\n",
    "\n",
    "if numeric_cols:\n",
    "    sample_var = numeric_cols[0]\n",
    "    print(\"Plotting sample:\", sample_var)\n",
    "    ax = df_input.groupby('time_period')[sample_var].sum().plot(title=f\"Total {sample_var} by time_period\", figsize=(10,4))\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "else:\n",
    "    print(\"No numeric columns to plot.\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "b64200ef-4baf-4633-9b39-f162d724a92c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: seaborn in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (0.13.2)\n",
      "Requirement already satisfied: numpy!=1.24.0,>=1.20 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from seaborn) (2.2.2)\n",
      "Requirement already satisfied: pandas>=1.2 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from seaborn) (2.2.3)\n",
      "Requirement already satisfied: matplotlib!=3.6.1,>=3.4 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from seaborn) (3.10.1)\n",
      "Requirement already satisfied: contourpy>=1.0.1 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (1.3.3)\n",
      "Requirement already satisfied: cycler>=0.10 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (0.12.1)\n",
      "Requirement already satisfied: fonttools>=4.22.0 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (4.61.0)\n",
      "Requirement already satisfied: kiwisolver>=1.3.1 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (1.4.9)\n",
      "Requirement already satisfied: packaging>=20.0 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (25.0)\n",
      "Requirement already satisfied: pillow>=8 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (12.0.0)\n",
      "Requirement already satisfied: pyparsing>=2.3.1 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (3.2.5)\n",
      "Requirement already satisfied: python-dateutil>=2.7 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from matplotlib!=3.6.1,>=3.4->seaborn) (2.9.0.post0)\n",
      "Requirement already satisfied: pytz>=2020.1 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from pandas>=1.2->seaborn) (2025.2)\n",
      "Requirement already satisfied: tzdata>=2022.7 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from pandas>=1.2->seaborn) (2025.2)\n",
      "Requirement already satisfied: six>=1.5 in c:\\users\\shanp\\miniconda3\\envs\\sisepuede\\lib\\site-packages (from python-dateutil>=2.7->matplotlib!=3.6.1,>=3.4->seaborn) (1.17.0)\n",
      "✓ Seaborn installed\n"
     ]
    }
   ],
   "source": [
    "# CELL 12.5: Install seaborn\n",
    "!pip install seaborn\n",
    "\n",
    "print(\"✓ Seaborn installed\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "2dc9abfe-8604-4253-af77-cbce0cec59de",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "✓ Visualization libraries ready\n"
     ]
    }
   ],
   "source": [
    "# CELL 13: Setup for Advanced Visualizations\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from matplotlib.patches import Rectangle\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "# Set style for better-looking plots\n",
    "plt.style.use('seaborn-v0_8-darkgrid')\n",
    "sns.set_palette(\"husl\")\n",
    "\n",
    "print(\"✓ Visualization libraries ready\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "aa31467e-cd98-437b-b852-4a1528f8e132",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Found 0 emission columns\n",
      "Sample emission columns: []\n",
      "\n",
      "Found 0 GDP/economic columns\n",
      "Sample GDP columns: []\n",
      "\n",
      "ENERGY: 2 columns\n",
      "\n",
      "IPPU: 5 columns\n"
     ]
    }
   ],
   "source": [
    "# CELL 14: Identify Emission and Economic Columns\n",
    "# Find all emission-related columns\n",
    "emission_cols = [col for col in df_input.columns if 'emission' in col.lower() or 'co2' in col.lower()]\n",
    "print(f\"Found {len(emission_cols)} emission columns\")\n",
    "print(\"Sample emission columns:\", emission_cols[:10])\n",
    "\n",
    "# Find GDP/economic columns\n",
    "gdp_cols = [col for col in df_input.columns if 'gdp' in col.lower() or 'economic' in col.lower() or 'value_added' in col.lower()]\n",
    "print(f\"\\nFound {len(gdp_cols)} GDP/economic columns\")\n",
    "print(\"Sample GDP columns:\", gdp_cols[:10])\n",
    "\n",
    "# Find sector-specific columns\n",
    "sector_keywords = ['agrc', 'energy', 'transport', 'waste', 'industry', 'ippu', 'afolu']\n",
    "sector_cols = {}\n",
    "for keyword in sector_keywords:\n",
    "    cols = [col for col in df_input.columns if keyword in col.lower()]\n",
    "    if cols:\n",
    "        sector_cols[keyword] = cols\n",
    "        print(f\"\\n{keyword.upper()}: {len(cols)} columns\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "09182522-3abb-4bcc-8d72-1ab14f5ede87",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "No emission columns found in dataset\n"
     ]
    }
   ],
   "source": [
    "# CELL 15: Calculate Total Emissions by Time Period\n",
    "# Aggregate all emission columns by time period\n",
    "if emission_cols:\n",
    "    # Select numeric emission columns only\n",
    "    valid_emission_cols = []\n",
    "    for col in emission_cols:\n",
    "        try:\n",
    "            if pd.api.types.is_numeric_dtype(df_input[col]):\n",
    "                valid_emission_cols.append(col)\n",
    "        except:\n",
    "            pass\n",
    "    \n",
    "    print(f\"Using {len(valid_emission_cols)} valid numeric emission columns\")\n",
    "    \n",
    "    if valid_emission_cols:\n",
    "        # Calculate total emissions per time period\n",
    "        df_emissions = df_input.groupby('time_period')[valid_emission_cols].sum()\n",
    "        df_emissions['total_emissions'] = df_emissions.sum(axis=1)\n",
    "        \n",
    "        print(\"\\nEmissions summary:\")\n",
    "        display(df_emissions[['total_emissions']].head(10))\n",
    "    else:\n",
    "        print(\"No valid numeric emission columns found\")\n",
    "        df_emissions = None\n",
    "else:\n",
    "    print(\"No emission columns found in dataset\")\n",
    "    df_emissions = None"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "30bd09fc-f9fe-441a-b00c-5fb0de20b70d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cannot create emissions chart - no valid data\n"
     ]
    }
   ],
   "source": [
    "# CELL 16: Create Stacked Area Chart (Like Your Screenshot)\n",
    "if df_emissions is not None and len(valid_emission_cols) > 0:\n",
    "    fig, ax = plt.subplots(figsize=(14, 8))\n",
    "    \n",
    "    # Select top emission sources for clarity (top 10)\n",
    "    top_cols = df_emissions[valid_emission_cols].iloc[-1].nlargest(10).index.tolist()\n",
    "    \n",
    "    # Create stacked area chart\n",
    "    df_plot = df_emissions[top_cols]\n",
    "    \n",
    "    # Fill between for stacked effect\n",
    "    ax.stackplot(df_plot.index, \n",
    "                 df_plot.T, \n",
    "                 labels=[col.replace('emission_co2e_', '').replace('_', ' ').title()[:30] \n",
    "                        for col in top_cols],\n",
    "                 alpha=0.8)\n",
    "    \n",
    "    # Overlay total line\n",
    "    ax.plot(df_emissions.index, df_emissions['total_emissions'], \n",
    "            color='navy', linewidth=3, label='Total Emissions', linestyle='--')\n",
    "    \n",
    "    ax.set_xlabel('Year', fontsize=12, fontweight='bold')\n",
    "    ax.set_ylabel('Emissions (CO2e)', fontsize=12, fontweight='bold')\n",
    "    ax.set_title('GHG Emissions Pathways by Source', fontsize=16, fontweight='bold', pad=20)\n",
    "    ax.legend(loc='upper left', bbox_to_anchor=(1.02, 1), fontsize=9)\n",
    "    ax.grid(True, alpha=0.3)\n",
    "    \n",
    "    plt.tight_layout()\n",
    "    plt.savefig(r'C:\\Users\\shanp\\emissions_pathway.png', dpi=300, bbox_inches='tight')\n",
    "    plt.show()\n",
    "    \n",
    "    print(\"✓ Chart saved to: C:\\\\Users\\\\shanp\\\\emissions_pathway.png\")\n",
    "else:\n",
    "    print(\"Cannot create emissions chart - no valid data\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "ce4be682-14ea-46a6-b3ad-3c6d5abf79ed",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Need df_transformed to create comparison. Run transformation first.\n"
     ]
    }
   ],
   "source": [
    "# CELL 17: Create Scenario Comparison (Baseline vs Transformations)\n",
    "if 'df_transformed' in globals() and df_emissions is not None:\n",
    "    # Calculate emissions from transformed data\n",
    "    df_trans_emissions = df_transformed.groupby('time_period')[valid_emission_cols].sum()\n",
    "    df_trans_emissions['total_emissions'] = df_trans_emissions.sum(axis=1)\n",
    "    \n",
    "    # Create comparison plot\n",
    "    fig, axes = plt.subplots(2, 2, figsize=(16, 10))\n",
    "    fig.suptitle('Scenario Comparison: Baseline vs Transformation', \n",
    "                 fontsize=18, fontweight='bold', y=1.02)\n",
    "    \n",
    "    # Plot 1: Total emissions comparison\n",
    "    ax1 = axes[0, 0]\n",
    "    ax1.fill_between(df_emissions.index, 0, df_emissions['total_emissions'], \n",
    "                     alpha=0.5, label='Baseline', color='red')\n",
    "    ax1.fill_between(df_trans_emissions.index, 0, df_trans_emissions['total_emissions'], \n",
    "                     alpha=0.5, label='With Transformation', color='green')\n",
    "    ax1.set_title('Total Emissions', fontweight='bold')\n",
    "    ax1.set_xlabel('Year')\n",
    "    ax1.set_ylabel('CO2e')\n",
    "    ax1.legend()\n",
    "    ax1.grid(True, alpha=0.3)\n",
    "    \n",
    "    # Plot 2: Emissions reduction\n",
    "    ax2 = axes[0, 1]\n",
    "    reduction = df_emissions['total_emissions'] - df_trans_emissions['total_emissions']\n",
    "    ax2.bar(df_emissions.index, reduction, color='green', alpha=0.7)\n",
    "    ax2.set_title('Annual Emissions Reduction', fontweight='bold')\n",
    "    ax2.set_xlabel('Year')\n",
    "    ax2.set_ylabel('CO2e Reduced')\n",
    "    ax2.grid(True, alpha=0.3)\n",
    "    \n",
    "    # Plot 3: Cumulative reduction\n",
    "    ax3 = axes[1, 0]\n",
    "    cumulative_reduction = reduction.cumsum()\n",
    "    ax3.plot(df_emissions.index, cumulative_reduction, \n",
    "            color='darkgreen', linewidth=3, marker='o')\n",
    "    ax3.fill_between(df_emissions.index, 0, cumulative_reduction, alpha=0.3, color='green')\n",
    "    ax3.set_title('Cumulative Emissions Avoided', fontweight='bold')\n",
    "    ax3.set_xlabel('Year')\n",
    "    ax3.set_ylabel('Total CO2e Avoided')\n",
    "    ax3.grid(True, alpha=0.3)\n",
    "    \n",
    "    # Plot 4: Percentage reduction\n",
    "    ax4 = axes[1, 1]\n",
    "    pct_reduction = (reduction / df_emissions['total_emissions']) * 100\n",
    "    ax4.plot(df_emissions.index, pct_reduction, \n",
    "            color='darkblue', linewidth=3, marker='s')\n",
    "    ax4.set_title('Percentage Reduction', fontweight='bold')\n",
    "    ax4.set_xlabel('Year')\n",
    "    ax4.set_ylabel('% Reduction')\n",
    "    ax4.grid(True, alpha=0.3)\n",
    "    \n",
    "    plt.tight_layout()\n",
    "    plt.savefig(r'C:\\Users\\shanp\\scenario_comparison.png', dpi=300, bbox_inches='tight')\n",
    "    plt.show()\n",
    "    \n",
    "    print(\"✓ Comparison chart saved\")\n",
    "    print(f\"Total emissions avoided: {cumulative_reduction.iloc[-1]:,.0f}\")\n",
    "    print(f\"Average annual reduction: {reduction.mean():,.0f}\")\n",
    "else:\n",
    "    print(\"Need df_transformed to create comparison. Run transformation first.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "0bab7ebc-eb15-418a-ac1d-9253ace05ba9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Dashboard function defined. Use after creating multiple scenarios.\n"
     ]
    }
   ],
   "source": [
    "# CELL 18: Create Multi-Scenario Dashboard (Like Tableau Layout)\n",
    "def create_dashboard(df_baseline, df_scenarios, scenario_names):\n",
    "    \"\"\"\n",
    "    Create a Tableau-style dashboard with multiple scenarios\n",
    "    \"\"\"\n",
    "    n_scenarios = len(df_scenarios)\n",
    "    fig = plt.figure(figsize=(18, 12))\n",
    "    \n",
    "    # Create grid\n",
    "    gs = fig.add_gridspec(3, n_scenarios + 1, hspace=0.3, wspace=0.3)\n",
    "    \n",
    "    # Title\n",
    "    fig.suptitle('GHG Emissions and Economic Pathways - Multi-Scenario Analysis', \n",
    "                 fontsize=20, fontweight='bold', y=0.98)\n",
    "    \n",
    "    # Row 1: Emissions pathways for each scenario\n",
    "    for i, (df_scenario, name) in enumerate(zip(df_scenarios, scenario_names)):\n",
    "        ax = fig.add_subplot(gs[0, i])\n",
    "        \n",
    "        # Calculate emissions\n",
    "        if valid_emission_cols:\n",
    "            emissions = df_scenario.groupby('time_period')[valid_emission_cols[:5]].sum()\n",
    "            ax.stackplot(emissions.index, emissions.T, alpha=0.7)\n",
    "            \n",
    "            # Add total line\n",
    "            total = emissions.sum(axis=1)\n",
    "            ax.plot(emissions.index, total, 'k-', linewidth=2, label='Total')\n",
    "            \n",
    "        ax.set_title(f'{name}\\nEmissions', fontweight='bold', fontsize=10)\n",
    "        ax.set_xlabel('Year', fontsize=8)\n",
    "        ax.grid(True, alpha=0.2)\n",
    "    \n",
    "    # Row 2: GDP pathways\n",
    "    for i, (df_scenario, name) in enumerate(zip(df_scenarios, scenario_names)):\n",
    "        ax = fig.add_subplot(gs[1, i])\n",
    "        \n",
    "        if gdp_cols:\n",
    "            gdp = df_scenario.groupby('time_period')[gdp_cols[:3]].sum()\n",
    "            for col in gdp.columns:\n",
    "                ax.plot(gdp.index, gdp[col], marker='o', markersize=3, linewidth=2)\n",
    "        \n",
    "        ax.set_title(f'{name}\\nEconomic Output', fontweight='bold', fontsize=10)\n",
    "        ax.set_xlabel('Year', fontsize=8)\n",
    "        ax.grid(True, alpha=0.2)\n",
    "    \n",
    "    # Row 3: Comparison metrics\n",
    "    ax_compare = fig.add_subplot(gs[2, :])\n",
    "    \n",
    "    # Calculate final year emissions for each scenario\n",
    "    final_emissions = []\n",
    "    for df_scenario in df_scenarios:\n",
    "        if valid_emission_cols:\n",
    "            final = df_scenario.groupby('time_period')[valid_emission_cols].sum().iloc[-1].sum()\n",
    "            final_emissions.append(final)\n",
    "    \n",
    "    if final_emissions:\n",
    "        x_pos = np.arange(len(scenario_names))\n",
    "        colors = plt.cm.RdYlGn_r(np.linspace(0.3, 0.7, len(scenario_names)))\n",
    "        bars = ax_compare.bar(x_pos, final_emissions, color=colors, alpha=0.8)\n",
    "        \n",
    "        # Add value labels on bars\n",
    "        for bar, val in zip(bars, final_emissions):\n",
    "            height = bar.get_height()\n",
    "            ax_compare.text(bar.get_x() + bar.get_width()/2., height,\n",
    "                          f'{val:,.0f}',\n",
    "                          ha='center', va='bottom', fontweight='bold')\n",
    "        \n",
    "        ax_compare.set_xticks(x_pos)\n",
    "        ax_compare.set_xticklabels(scenario_names, rotation=45, ha='right')\n",
    "        ax_compare.set_title('Final Year (2050) Total Emissions Comparison', \n",
    "                           fontweight='bold', fontsize=12)\n",
    "        ax_compare.set_ylabel('Total CO2e', fontweight='bold')\n",
    "        ax_compare.grid(True, alpha=0.2, axis='y')\n",
    "    \n",
    "    plt.savefig(r'C:\\Users\\shanp\\multi_scenario_dashboard.png', dpi=300, bbox_inches='tight')\n",
    "    plt.show()\n",
    "    \n",
    "    print(\"✓ Dashboard saved to: C:\\\\Users\\\\shanp\\\\multi_scenario_dashboard.png\")\n",
    "\n",
    "# Example usage (you need to create multiple scenarios first)\n",
    "print(\"Dashboard function defined. Use after creating multiple scenarios.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "34d84a4e-576f-4869-8433-fcdd338f3359",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Transformers not available - load sisepuede first\n"
     ]
    }
   ],
   "source": [
    "# CELL 19: Run Multiple Transformations and Create Dashboard\n",
    "if transformers is not None:\n",
    "    print(\"Creating multiple transformation scenarios...\")\n",
    "    \n",
    "    # Select different transformers to compare\n",
    "    transformer_codes = [\n",
    "        \"TFR:ENTC:TARGET_RENEWABLE_ELEC\",\n",
    "        \"TFR:TRNS:SHIFT_FUEL_LIGHT_DUTY\",\n",
    "        \"TFR:AGRC:INC_PRODUCTIVITY\",\n",
    "        \"TFR:WASO:INC_RECYCLING\"\n",
    "    ]\n",
    "    \n",
    "    scenarios = [df_input]  # Baseline\n",
    "    scenario_names = [\"Baseline\"]\n",
    "    \n",
    "    for code in transformer_codes:\n",
    "        try:\n",
    "            transformer = transformers.get_transformer(code)\n",
    "            df_scenario = transformer()\n",
    "            scenarios.append(df_scenario)\n",
    "            \n",
    "            # Create readable name\n",
    "            name = code.split(':')[-1].replace('_', ' ').title()\n",
    "            scenario_names.append(name)\n",
    "            \n",
    "            print(f\"✓ Created scenario: {name}\")\n",
    "        except Exception as e:\n",
    "            print(f\"✗ Failed to create {code}: {str(e)[:100]}\")\n",
    "    \n",
    "    # Create dashboard\n",
    "    if len(scenarios) > 1:\n",
    "        create_dashboard(df_input, scenarios, scenario_names)\n",
    "    else:\n",
    "        print(\"Not enough scenarios created for dashboard\")\n",
    "else:\n",
    "    print(\"Transformers not available - load sisepuede first\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "c0881604-f74d-43b4-a832-ff06de93c980",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "✓ Results exported to: C:\\Users\\shanp\\sisepuede_analysis_results.xlsx\n"
     ]
    }
   ],
   "source": [
    "# CELL 20: Export Results Summary\n",
    "# Create summary Excel file with multiple sheets\n",
    "output_excel = r\"C:\\Users\\shanp\\sisepuede_analysis_results.xlsx\"\n",
    "\n",
    "with pd.ExcelWriter(output_excel, engine='openpyxl') as writer:\n",
    "    # Sheet 1: Baseline emissions\n",
    "    if df_emissions is not None:\n",
    "        df_emissions.to_excel(writer, sheet_name='Baseline_Emissions')\n",
    "    \n",
    "    # Sheet 2: Transformed emissions (if available)\n",
    "    if 'df_trans_emissions' in globals():\n",
    "        df_trans_emissions.to_excel(writer, sheet_name='Transformed_Emissions')\n",
    "    \n",
    "    # Sheet 3: Summary statistics\n",
    "    summary_data = {\n",
    "        'Metric': ['Total Columns', 'Emission Columns', 'GDP Columns', \n",
    "                   'Time Periods', 'Regions'],\n",
    "        'Count': [len(df_input.columns), len(emission_cols) if emission_cols else 0,\n",
    "                 len(gdp_cols) if gdp_cols else 0,\n",
    "                 df_input['time_period'].nunique(),\n",
    "                 df_input['region'].nunique()]\n",
    "    }\n",
    "    pd.DataFrame(summary_data).to_excel(writer, sheet_name='Summary', index=False)\n",
    "    \n",
    "    print(f\"✓ Results exported to: {output_excel}\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.14"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
